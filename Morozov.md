# Курсовая работа

**Тема:** База данных агентства по аренде квартир.

**Студент:** Морозов Николай Константинович.

**Группа:** 414.

# Содержание

- [Введение](#введение)
- [Анализ предметной области](#анализ-предметной-области)
- [Инфологическая модель базы данных](#инфологическая-модель-базы-данных)
- [Логическая структура базы данных](#логическая-структура-базы-данных)
- [Физическая структура базы данных](#физическая-структура-базы-данных)
- [Реализация проекта в СУБД](#реализация-проекта-в-субд)
- [Заключение](#заключение)
- [Список использованных источников](#список-использованных-источников)


# Введение

## Актуальность
В современных условиях городской жизни спрос на аренду жилья стабильно увеличивается, особенно в крупных мегаполисах и студенческих городках. Этот рост связан с рядом социально-экономических факторов, таких как урбанизация, мобильность населения, высокая стоимость покупки недвижимости и спрос на временное проживание. Рынок аренды жилья становится всё более конкурентным, а запросы клиентов — более индивидуальными и разнообразными. Агентствам по аренде квартир необходимо обрабатывать значительные объемы данных о клиентах, квартирах, условиях аренды, а также отслеживать процессы взаимодействия между клиентами и сотрудниками агентства.

С развитием информационных технологий базы данных стали важным инструментом для систематизации, анализа и хранения информации. Для агентства по аренде квартир эффективное использование базы данных позволяет автоматизировать большинство процессов, связанных с управлением данными, что, в свою очередь, значительно ускоряет процессы поиска и подбора жилья для клиентов. Применение базы данных позволяет минимизировать ошибки, сократить время обработки запросов, улучшить качество обслуживания, а также обеспечить прозрачность и актуальность информации. Таким образом, актуальность разработки базы данных для агентства по аренде квартир заключается не только в повышении эффективности работы агентства, но и в улучшении опыта клиентов, что способствует росту их удовлетворенности и лояльности.


## Цель
Целью данной работы является создание базы данных, которая будет включать в себя хранение информации о клиентах, квартирах, аренде и сотрудниках агентства. Данная база данных должна стать основным инструментом для систематического и эффективного управления данными, касающимися аренды жилья, что позволит агентству более точно и быстро выполнять запросы клиентов.

## Задачи
Для достижения поставленной цели необходимо выполнить следующие задачи:

1. Проанализировать требования к базе данных для агентства по аренде квартир, определить ключевые процессы, которые должны быть автоматизированы, и необходимые категории данных.
2. Разработать структуру базы данных, включающую таблицы и связи, которые будут поддерживать хранение и обработку информации о клиентах, объектах аренды, договорах аренды и сотрудниках агентства.
3. Реализовать таблицы и установить отношения между ними для эффективного управления данными в соответствии с функциональными требованиями агентства.



 ## 1. Анализ предметной области. Постановка задачи

### 1.1. Описание предметной области и функции решаемых задач
Предметной областью данной базы данных является управление процессом аренды квартир в агентстве недвижимости. Эта сфера деятельности предполагает большое количество операций, связанных с обработкой данных о недвижимости, клиентах и договорах аренды. Система решает широкий спектр задач, обеспечивая автоматизацию и оптимизацию основных процессов агентства.

Ключевая задача системы — регистрация информации о клиентах, сотрудниках, квартирах и договорах аренды. Система хранит данные о клиентах, включая их имена, контактные данные и историю арендных обращений, а также информацию о сотрудниках, таких как их имена, должности и права доступа к данным. Кроме того, система регистрирует сведения о квартирах, включая их адреса, характеристики (количество комнат, площадь, стоимость аренды) и статус (доступна для аренды или уже занята).

База данных позволяет сотрудникам агентства управлять процессом аренды: от поиска подходящего жилья для клиентов до заключения и сопровождения договоров аренды. Система также облегчает взаимодействие между агентами и клиентами, помогая с выбором жилья и оформлением аренды, а также поддерживает управление договорами. Функциональные возможности системы охватывают процесс подачи заявок, отслеживание истории арендных сделок, обновление информации о статусе квартир и анализ данных для построения статистики и отчетов. Эти функции позволяют агентству быстро обрабатывать клиентские запросы, своевременно отслеживать изменения и поддерживать актуальную информацию о доступных квартирах.


### 1.2. Перечень входных данных
Для функционирования системы необходима регистрация следующих данных:

- **Данные клиентов**: включают полные имена клиентов, их контактную информацию (телефон, адрес электронной почты) и другие персональные данные, необходимые для связи и обслуживания.
- **Данные квартир**: содержат адрес объекта, количество комнат, площадь квартиры, стоимость аренды, текущее состояние (например, доступна для аренды или занята), а также дополнительные характеристики, такие как тип ремонта, наличие мебели, этаж и вид из окон.
- **Данные сотрудников**: включают фамилию, имя и отчество сотрудников, занимаемую должность, права доступа к различным данным в системе, а также контактные данные для внутреннего пользования.
- **Данные по аренде**: это информация о заключённых арендных сделках, в частности, данные клиента, конкретная квартира, срок аренды, стоимость аренды, а также условия и статус договора (например, подписан, активен, завершён).

Эти данные используются для поддержки процессов управления, анализа и создания отчетности, а также обеспечения безопасности хранения информации.


### 1.3. Перечень выходных данных
Система генерирует ряд выходных данных, которые способствуют улучшению работы агентства и обеспечению качественного обслуживания клиентов:

- **Список доступных квартир**: регулярно обновляется в реальном времени, обеспечивая доступ к актуальной информации о свободных объектах недвижимости.
- **История арендных сделок**: хранит записи обо всех совершённых арендных операциях, включая данные по каждому договору, условия и срок действия аренды, а также историю обращений клиента.
- **Статистика по аренде**: предоставляет агрегированные данные, включая общие суммы по арендным платежам, средние сроки аренды, загрузку объектов в определенные периоды и другие показатели, которые помогают агентству оценить результаты работы и принять обоснованные управленческие решения.


### 1.4. Ограничения предметной области
Для корректного функционирования системы необходимо соблюдать ряд ограничений:

- **Аренда доступна только для свободных квартир**: система отслеживает статус всех объектов недвижимости, и только квартиры, не занятые по другим договорам аренды, доступны для выбора клиентами.
- **Ограничение доступа к данным сотрудников**: согласно политике безопасности, система ограничивает доступ к персональным данным сотрудников, предоставляя только авторизованным лицам права на просмотр и редактирование данной информации.
- **Сроки аренды могут быть ограничены договорными условиями**: на практике сроки аренды зависят от условий договора, и система учитывает эти ограничения, предотвращая продление аренды сверх предусмотренных условий, если это не оговорено отдельно.


## 2. Инфологическая (концептуальная) модель базы данных

### 2.1. Выделение информационных объектов
Основными информационными объектами в системе аренды квартир являются:

- **Клиенты**: физические лица, заинтересованные в аренде жилья через агентство недвижимости. Клиенты являются ключевыми участниками процесса аренды, и информация о них необходима для заключения договоров и поддержания долгосрочных отношений с агентством.
- **Квартиры**: объекты недвижимости, предлагаемые для аренды. Квартиры обладают уникальными характеристиками, которые позволяют клиентам делать выбор в соответствии с их потребностями и возможностями.
- **Аренда**: отношение между клиентом и квартирой, фиксирующее параметры аренды. Этот объект описывает детали аренды, такие как период действия договора и стоимость аренды, что позволяет вести учет финансовых транзакций и сроков аренды.
- **Сотрудники**: представители агентства, ответственные за взаимодействие с клиентами и управление процессами аренды. Сотрудники выполняют ключевые функции по координации сделок, взаимодействию с клиентами и обновлению информации о статусе квартир.


### 2.2. Определение атрибутов объектов

Для эффективного управления данными в системе каждому информационному объекту присваиваются определенные атрибуты, которые описывают его уникальные характеристики:

- **Клиенты**:  
  - `ID клиента` — уникальный идентификатор клиента.  
  - `Имя` и `Фамилия` — личные данные клиента для идентификации.
  - `Email` и `Телефон` — контактные данные для связи и уведомлений.
  
- **Квартиры**:  
  - `ID квартиры` — уникальный идентификатор объекта недвижимости.  
  - `Адрес` — местоположение квартиры.
  - `Количество комнат` — число комнат в квартире.
  - `Площадь` — жилая площадь квартиры в квадратных метрах.
  - `Цена` — стоимость аренды, определяемая агентством.
  - `Доступность` — статус, показывающий, свободна ли квартира для аренды.

- **Аренда**:  
  - `ID аренды` — уникальный идентификатор арендной сделки.
  - `ID клиента` — ссылка на клиента, заключившего договор.
  - `ID квартиры` — ссылка на квартиру, сдаваемую в аренду.
  - `Дата начала` и `Дата окончания` — временные рамки действия договора.
  - `Цена аренды` — стоимость аренды за период, указанный в договоре.

- **Сотрудники**:  
  - `ID сотрудника` — уникальный идентификатор сотрудника агентства.
  - `Имя` и `Фамилия` — персональные данные для идентификации.
  - `Должность` — позиция сотрудника в агентстве, что может определять его права и обязанности в системе.


### 2.3. Определение отношений и мощности отношений между объектами
Система управления арендами требует определения связей между объектами для учета всех аспектов процесса аренды. Важно указать, как информационные объекты взаимодействуют друг с другом и какую мощность имеют эти связи:

- **Клиенты - Аренда**:  
  - Один клиент может заключать несколько арендных договоров с агентством, арендовать разные квартиры по отдельным контрактам (например, в случае долгосрочного сотрудничества или одновременной аренды нескольких объектов).  
  - Каждый договор аренды, однако, всегда связан только с одним конкретным клиентом.
  - Отношение имеет мощность 1:N.

- **Квартиры - Аренда**:  
  - Каждая квартира может быть арендована несколько раз с разными клиентами по очереди, что особенно важно для учета истории аренды и управления доступностью объекта.
  - Каждый отдельный договор аренды связан только с одной конкретной квартирой.
  - Отношение имеет мощность 1:N.

- **Сотрудники - Аренда**:  
  - Один сотрудник агентства может быть назначен на ведение множества арендных сделок, выполняя функции сопровождения клиента, управления документацией и контроля сроков аренды.  
  - Каждая аренда связана с одним сотрудником, который отвечает за сделку от начала до завершения.
  - Отношение имеет мощность 1:N.

Эти отношения и их мощности позволяют описать структуру данных и взаимодействие между информационными объектами в системе аренды, обеспечивая поддержку всех функциональных задач агентства.


### 2.4. Построение концептуальной модели
![Фото](1.png)

### 3. Логическая структура базы данных

Логическая структура базы данных описывает, как данные организованы и как они связаны между собой с точки зрения бизнес-правил и требований системы.

1. **Таблица `Clients`** хранит информацию о клиентах. Каждый клиент имеет уникальный идентификатор (`client_id`), имя, фамилию, электронную почту и телефон.
   
2. **Таблица `Apartments`** хранит данные о квартирах, которые агентство сдает в аренду. Каждая квартира имеет уникальный идентификатор (`apartment_id`), адрес, количество комнат, площадь, цену аренды и флаг доступности.

3. **Таблица `Employees`** хранит информацию о сотрудниках агентства. Каждый сотрудник имеет уникальный идентификатор (`employee_id`), имя, фамилию и должность.

4. **Таблица `Rentals`** связывает клиентов с квартирами, которые они арендуют, а также указывает сотрудника, который оформил сделку. Эта таблица включает уникальный идентификатор аренды (`rental_id`), даты начала и окончания аренды, стоимость аренды, а также внешние ключи, связывающие аренду с конкретным клиентом (`client_id`), квартирой (`apartment_id`) и сотрудником (`employee_id`).

#### Важные связи между таблицами:
- **Связь между таблицами `Clients` и `Rentals`**: Один клиент может арендовать несколько квартир, поэтому существует связь "один ко многим" между таблицей клиентов и таблицей аренды. В `Rentals` хранится внешний ключ `client_id`, который ссылается на клиента в таблице `Clients`.
  
- **Связь между таблицами `Apartments` и `Rentals`**: Одна квартира может быть арендована несколько раз, поэтому существует связь "один ко многим" между таблицей квартир и таблицей аренды. В таблице `Rentals` хранится внешний ключ `apartment_id`, который ссылается на квартиру в таблице `Apartments`.

- **Связь между таблицами `Employees` и `Rentals`**: Один сотрудник может оформить несколько сделок аренды, то есть между таблицей сотрудников и таблицей аренды также существует связь "один ко многим". В таблице `Rentals` хранится внешний ключ `employee_id`, который ссылается на сотрудника в таблице `Employees`.

### 4. Физическая структура базы данных в PostgreSQL

Физическая структура базы данных в PostgreSQL описывает, как данные будут храниться в системе управления базами данных, включая использование типов данных, индексов и механизмов хранения данных.

1. **Типы данных**:
   - В PostgreSQL для строковых данных используется тип `VARCHAR`, который может хранить строки переменной длины. Например, для поля `first_name` в таблице `Clients` мы указываем `VARCHAR(50)`.
   - Для уникальных идентификаторов, как в `client_id`, `apartment_id` и других, используется тип `SERIAL`. В PostgreSQL это автоматически создаёт целочисленное поле с автоинкрементом, которое является уникальным для каждой записи.
   - Для флагов и булевых значений используется тип `BOOLEAN`. Например, в таблице `Apartments` поле `available` будет использоваться для хранения информации о доступности квартиры.
   - Для хранения дат в PostgreSQL используется тип `DATE`, что позволяет точно хранить дату без времени.

2. **Индексы**:
   - В PostgreSQL при создании таблиц с первичными ключами автоматически создаются **индексы** для этих ключей. Это ускоряет операции поиска и связывания данных.
   - Для **внешних ключей** PostgreSQL автоматически создает индексы, чтобы ускорить поиск и операции объединения данных. Например, индексы для полей `client_id`, `apartment_id` и `employee_id` в таблице `Rentals` улучшат производительность запросов.

3. **Хранение данных**:
   - В PostgreSQL данные таблиц хранятся на диске в виде файлов в **сегментах** или **таблицах**, которые управляются внутри **табличных пространств**. Каждый сегмент отвечает за хранение данных таблицы, и PostgreSQL эффективно управляет распределением данных между сегментами для обеспечения быстрого доступа.

4. **Ссылочная целостность**:
   - В PostgreSQL гарантируется **ссылочная целостность** через использование внешних ключей. Система автоматически отслеживает целостность данных между таблицами, обеспечивая, чтобы, например, не было аренды без существующего клиента или квартиры.
   - Также PostgreSQL поддерживает различные действия при удалении или обновлении данных с использованием внешних ключей, например, **ON DELETE CASCADE** для автоматического удаления связанных данных при удалении записи.

Таким образом, физическая структура базы данных в PostgreSQL включает использование эффективных типов данных, индексов, механизмов хранения и ссылочной целостности для обеспечения быстрого доступа и защиты данных.

## 5. Реализация проекта в среде конкретной СУБД 

Проект реализуется в среде **PostgreSQL**. 

---

### 3.1. Создание таблиц

Для начала создадим необходимые таблицы для хранения информации о клиентах, квартирах, сотрудниках и договорах аренды. Пример SQL-запросов:

```sql
-- Создание таблицы клиентов
CREATE TABLE Clients (
    client_id SERIAL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100),
    phone VARCHAR(15)
);

-- Создание таблицы квартир
CREATE TABLE Apartments (
    apartment_id SERIAL PRIMARY KEY,
    address VARCHAR(255) NOT NULL,
    number_of_rooms INT,
    area INT,
    price INT NOT NULL,
    available BOOLEAN DEFAULT TRUE
);

-- Создание таблицы сотрудников
CREATE TABLE Employees (
    employee_id SERIAL PRIMARY KEY,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    position VARCHAR(50)
);

-- Создание таблицы аренды
CREATE TABLE Rentals (
    rental_id SERIAL PRIMARY KEY,
    client_id INT,
    apartment_id INT,
    employee_id INT,
    start_date DATE,
    end_date DATE,
    rental_price INT,
    FOREIGN KEY (client_id) REFERENCES Clients(client_id),
    FOREIGN KEY (apartment_id) REFERENCES Apartments(apartment_id),
    FOREIGN KEY (employee_id) REFERENCES Employees(employee_id)
);
```

Каждая из этих таблиц имеет свои атрибуты:

Clients — информация о клиентах, включая имя, фамилию, email и телефон.

Apartments — данные о квартирах, такие как адрес, количество комнат, площадь и стоимость аренды.

Employees — данные о сотрудниках агентства, их должности и имена.

Rentals — данные о заключенных договорах аренды, ссылаются на клиента, квартиру и сотрудника, который оформил аренду.


### 3.2. SQL-запросы PostgreSQL для базы данных агентства аренды квартир
Запросы к базе данных агентства аренды квартир играют ключевую роль в обеспечении эффективного управления данными, автоматизации процессов и поддержки бизнес-операций агентства. Используя SQL-запросы, можно выполнять различные действия, такие как добавление, изменение, удаление данных и их анализ. В рамках данной базы данных запросы позволяют:

Управлять информацией о клиентах, квартирах, сотрудниках и аренде: добавлять новых клиентов и сотрудников, обновлять данные о квартирах и договорах аренды.
Получать актуальные данные для анализа и отчетности: получать информацию о доступных квартирах, завершенных арендах, выручке и статистике по аренде.
Поддерживать порядок и точность данных: обновлять или удалять устаревшие данные, такие как истекшие договоры аренды или недействительные контактные данные.
Обеспечить доступ к критически важным данным для принятия решений: с помощью запросов сотрудники агентства могут быстро найти подходящие квартиры для аренды, отслеживать занятость, устанавливать цены и анализировать рыночные тенденции.
Эти запросы позволяют автоматизировать управление базой данных и поддерживать высокую эффективность работы агентства.

```sql
-- 1. Добавление нового клиента
INSERT INTO Clients (first_name, last_name, email, phone)
VALUES ('Анна', 'Смирнова', 'anna.smirnova@example.com', '+79123456789');

-- 2. Добавление новой квартиры
INSERT INTO Apartments (address, number_of_rooms, area, price, available)
VALUES ('ул. Пушкина, д. 10', 2, 55, 30000, TRUE);

-- 3. Добавление нового сотрудника
INSERT INTO Employees (first_name, last_name, position)
VALUES ('Сергей', 'Иванов', 'Менеджер');

-- 4. Создание новой записи об аренде
INSERT INTO Rentals (client_id, apartment_id, employee_id, start_date, end_date, rental_price)
VALUES (1, 2, 1, '2024-11-01', '2025-11-01', 30000);

-- 5. Обновление информации о клиенте
UPDATE Clients SET email = 'new_email@example.com' WHERE client_id = 1;

-- 6. Обновление стоимости аренды квартиры
UPDATE Apartments SET price = 35000 WHERE apartment_id = 2;

-- 7. Удаление записи о клиенте
DELETE FROM Clients WHERE client_id = 5;

-- 8. Удаление записи о квартире
DELETE FROM Apartments WHERE apartment_id = 3;

-- 9. Поиск всех квартир с ценой аренды ниже 30000
SELECT * FROM Apartments WHERE price < 30000;

-- 10. Поиск всех клиентов с указанием email
SELECT * FROM Clients WHERE email IS NOT NULL;

-- 11. Получение всех доступных квартир
SELECT * FROM Apartments WHERE available = TRUE;

-- 12. Поиск клиентов, арендующих квартиры через определенного менеджера
SELECT c.first_name, c.last_name FROM Rentals r
JOIN Clients c ON r.client_id = c.client_id
WHERE r.employee_id = 1;

-- 13. Изменение доступности квартиры
UPDATE Apartments SET available = FALSE WHERE apartment_id = 1;

-- 14. Получение списка всех квартир по убыванию цены
SELECT * FROM Apartments ORDER BY price DESC;

-- 15. Подсчет общего количества клиентов
SELECT COUNT(*) FROM Clients;

-- 16. Подсчет количества занятых квартир
SELECT COUNT(*) FROM Apartments WHERE available = FALSE;

-- 17. Суммарная выручка от всех договоров аренды
SELECT SUM(rental_price) FROM Rentals;

-- 18. Средняя стоимость аренды квартир
SELECT AVG(price) FROM Apartments;

-- 19. Вывод всех договоров аренды, заканчивающихся в текущем месяце
SELECT * FROM Rentals WHERE end_date BETWEEN '2024-11-01' AND '2024-11-30';

-- 20. Обновление должности сотрудника
UPDATE Employees SET position = 'Старший менеджер' WHERE employee_id = 1;

-- 21. Поиск квартир с площадью более 70 кв.м
SELECT * FROM Apartments WHERE area > 70;

-- 22. Поиск всех сотрудников с должностью "Менеджер"
SELECT * FROM Employees WHERE position = 'Менеджер';

-- 23. Удаление всех договоров аренды, срок которых истек
DELETE FROM Rentals WHERE end_date < CURRENT_DATE;

-- 24. Установка скидки на аренду для конкретной квартиры
UPDATE Apartments SET price = price * 0.9 WHERE apartment_id = 2;

-- 25. Получение списка всех клиентов с сортировкой по фамилии
SELECT * FROM Clients ORDER BY last_name;

-- 26. Сотрудники, имеющих хотя бы 1 договор
SELECT DISTINCT e.first_name, e.last_name
FROM Employees e
JOIN Rentals r ON e.employee_id = r.employee_id
WHERE r.end_date >= CURRENT_DATE;

-- 27. Изменение номера телефона клиента
UPDATE Clients SET phone = '+79111234567' WHERE client_id = 1;

-- 28. Добавление нового договора аренды с текущей датой начала
INSERT INTO Rentals (client_id, apartment_id, employee_id, start_date, end_date, rental_price)
VALUES (2, 3, 1, CURRENT_DATE, '2025-11-01', 40000);

-- 29. Подсчет количества договоров аренды по каждому клиенту
SELECT client_id, COUNT(*) AS rental_count
FROM Rentals
GROUP BY client_id;

-- 30. Поиск всех сотрудников, связанных с определенными договорами аренды
SELECT DISTINCT e.first_name, e.last_name FROM Employees e
JOIN Rentals r ON e.employee_id = r.employee_id;
```

# Заключение
В результате выполнения курсовой работы была разработана и реализована база данных для агентства по аренде квартир. Проанализирована предметная область, определены основные объекты и связи между ними, а также создана концептуальная модель данных. Реализация базы данных с помощью СУБД PostgreSQL позволила организовать структуру хранения информации о клиентах, квартирах, аренде и сотрудниках. База данных автоматизирует ключевые бизнес-процессы агентства: управление информацией о квартирах и аренде, взаимодействие с клиентами и сотрудниками, а также обработку запросов. Создание и тестирование SQL-запросов продемонстрировало возможности системы для получения аналитических данных, что повышает эффективность управления агентством и способствует развитию бизнеса.

 # Список использованных источников

 Корбут А.А. Основы проектирования баз данных. Учебное пособие. — М.: Издательство МГТУ, 2020. 
 
 Официальная документация PostgreSQL. https://www.postgresql.org/docs/





